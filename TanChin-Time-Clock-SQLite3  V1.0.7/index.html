<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>震欣科技AI作息系統 (貝兒公主奇蹟版)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Kaisei+Tokumin:wght@400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 基礎樣式與預設主題 */
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f0f4f8;
            background-image: linear-gradient(to top, #dfe9f3 0%, white 100%);
            transition: background-image 0.8s ease-in-out, background-color 0.8s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow-y: auto; /* 允許垂直滾動 */
        }
        .magic-container { 
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 10px 10px 20px #c8cacc, -10px -10px 20px #ffffff; 
            transition: background-color 0.8s ease-in-out;
            position: relative;
            z-index: 10;
        }
        
        /* 內建主題魔法 */
        body.theme-christmas {
            background-image: linear-gradient(to top, #0250c5 0%, #d43f8d 100%);
        }
        #clock-panel.theme-christmas {
            background-color: #1e6b34;
            position: relative;
        }
        body.theme-cny {
            background-image: linear-gradient(to right, #b82e1f, #e34425 50%, #b82e1f);
        }

        .btn-magic { transition: all 0.3s ease; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .btn-magic:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .btn-magic:active { transform: translateY(1px); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .input-magic:focus { border-color: #4a90e2; box-shadow: 0 0 10px rgba(74, 144, 226, 0.3); }
        .message-box { transition: all 0.5s ease-in-out; opacity: 0; transform: translateY(-20px); }
        .message-box.show { opacity: 1; transform: translateY(0); }
        .collapsible-panel { max-height: 0; overflow: hidden; transition: max-height 0.7s ease-in-out; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        
        #theme-editor-modal { z-index: 1001; }
        #confirm-modal { z-index: 1002; }

        @keyframes shake-error { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
        .shake-error { animation: shake-error 0.5s ease-in-out; }
        #roster-table th, #report-table th { cursor: pointer; user-select: none; }
        #roster-table th:hover, #report-table th:hover { background-color: #f0f4f8; }
        .sort-indicator { display: inline-block; margin-left: 5px; opacity: 0.5; width: 1em; }
        .weekday-btn { transition: all 0.2s ease; }
        .weekday-btn.active { background-color: #4a90e2; color: white; }
        
        #toast-container { position: fixed; bottom: 1rem; right: 1rem; z-index: 2000; display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem; }
        .toast-bubble { padding: 0.75rem 1.25rem; border-radius: 9999px; color: white; font-weight: 500; box-shadow: 0 4px 15px rgba(0,0,0,0.1); opacity: 0; transform: translateX(100%); animation: slide-in-out 3s forwards ease-in-out; }
        .toast-bubble.success { background-color: #28a745; }
        .toast-bubble.error { background-color: #dc3545; }
        .toast-bubble.info { background-color: #17a2b8; }
        @keyframes slide-in-out { 0% { opacity: 0; transform: translateX(100%); } 20% { opacity: 1; transform: translateX(0); } 80% { opacity: 1; transform: translateX(0); } 100% { opacity: 0; transform: translateX(100%); } }
    
        /* 動態主題 & 特效 */
        #dynamic-theme-styles { display: none; }
        @keyframes blink-border { 50% { box-shadow: 0 0 15px 5px var(--blink-color, #fbc02d); } }
        .blinking-border { animation: blink-border 2s infinite; }
        #punch-effect-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .falling-element { position: absolute; top: -50px; animation: fall linear forwards; user-select: none; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); opacity: 0; } }

        .clock-decoration {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 110%;
            height: 120%;
            font-size: 1.5rem;
            color: white;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0.8;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        .clock-decoration-left, .clock-decoration-right {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            height: 100%;
        }
    </style>
    <style id="dynamic-theme-styles"></style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="punch-effect-container"></div>
    <div class="magic-container w-full max-w-5xl p-6 sm:p-8 rounded-2xl">
        <!-- 主畫面 -->
        <header class="text-center mb-6">
            <h1 id="main-title" class="text-3xl sm:text-4xl font-bold text-gray-800">震欣科技AI作息系統</h1>
            <div id="clock-panel" class="bg-gray-800 text-white rounded-lg p-4 mt-4 text-center shadow-inner transition-all duration-500 relative">
                <div id="clock-decoration-container"></div>
                <p id="current-date" class="text-lg"></p>
                <p id="current-time" class="text-5xl font-mono font-bold tracking-wider"></p>
                <div id="clock-panel-symbols-container" class="absolute top-0 left-0 w-full h-full pointer-events-none flex justify-between items-center px-4 text-3xl opacity-80"></div>
            </div>
        </header>
        <div id="punch-area" class="mb-4">
            <label for="punch-input" class="block text-sm font-medium text-gray-700 mb-2">感應或輸入卡號/密碼 (全域輸入)</label>
            <input type="password" id="punch-input" class="input-magic w-full p-4 text-2xl text-center border border-gray-300 rounded-lg focus:outline-none" placeholder="...輸入區...">
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <div><label for="shift-selector" class="block text-sm font-medium text-gray-700 mb-2">當前班別</label><select id="shift-selector" class="input-magic w-full p-3 text-lg border border-gray-300 rounded-lg"></select></div>
            <div><label for="punch-status-selector" class="block text-sm font-medium text-gray-700 mb-2">打卡狀態</label><select id="punch-status-selector" class="input-magic w-full p-3 text-lg border border-gray-300 rounded-lg"><option value="auto">系統自動判斷</option><option value="in">上班</option><option value="out">下班</option></select></div>
        </div>
        <div id="message-box" class="message-box min-h-[60px] p-4 mb-6 rounded-lg text-center font-semibold text-lg"></div>
        
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mb-6">
            <button id="toggle-panel-btn" class="btn-magic bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6">管理者設定</button>
            <button id="toggle-report-btn" class="btn-magic bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6">考勤報表</button>
            <button id="open-automation-btn" class="btn-magic bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6">AI系統控制</button>
        </div>
        
        <!-- 管理者面板 -->
        <div id="management-panel" class="collapsible-panel overflow-hidden">
             <div class="p-4 border-t-2 border-gray-200 grid grid-cols-1 gap-8">
                <!-- Section 1: 人員 & 班別 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 人員資料設定 -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">人員資料設定</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input id="emp-id" type="text" placeholder="工號*" class="input-magic p-2 border rounded">
                            <input id="emp-name" type="text" placeholder="姓名*" class="input-magic p-2 border rounded">
                            <input id="emp-gender" type="text" placeholder="性別" class="input-magic p-2 border rounded">
                            <input id="emp-department" type="text" placeholder="部門*" class="input-magic p-2 border rounded">
                            <input id="emp-card" type="text" placeholder="卡號*" class="input-magic p-2 border rounded">
                            <input id="emp-password" type="password" placeholder="打卡密碼*" class="input-magic p-2 border rounded">
                            <input id="emp-nationality" type="text" placeholder="國籍" class="input-magic p-2 border rounded">
                            <input id="emp-birth-date" type="text" placeholder="出生日" class="input-magic p-2 border rounded" onfocus="(this.type='date')" onblur="if(!this.value)this.type='text'">
                            <input id="emp-hire-date" type="text" placeholder="到職日" class="input-magic p-2 border rounded" onfocus="(this.type='date')" onblur="if(!this.value)this.type='text'">
                            <input id="emp-termination-date" type="text" placeholder="離職日" class="input-magic p-2 border rounded" onfocus="(this.type='date')" onblur="if(!this.value)this.type='text'">
                            <input id="emp-notes" type="text" placeholder="備註" class="input-magic p-2 border rounded col-span-2">
                        </div>
                        <button id="save-employee-btn" class="btn-magic w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4">新增/更新員工</button>
                        <div class="mt-4 p-4 border rounded bg-gray-50">
                            <label class="block text-sm font-medium text-gray-700">匯入/匯出名冊 (CSV)</label>
                            <div class="flex justify-between items-center mt-2">
                                <button id="import-csv-btn" class="text-blue-600 hover:underline">選擇檔案匯入</button>
                                <button id="export-csv-btn" class="text-green-600 hover:underline">匯出完整名冊</button>
                            </div>
                            <span id="csv-file-name" class="text-gray-500 ml-2 text-sm"></span>
                        </div>
                        <button id="manage-roster-btn" class="btn-magic w-full mt-4 bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4">所有人員名冊</button>
                    </div>
                    <!-- 班別設定 -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">班別設定</h3>
                        <div id="shift-settings-container" class="space-y-3"></div>
                        <button id="save-shifts-btn" class="btn-magic w-full mt-4 bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4">儲存班別設定</button>
                    </div>
                </div>

                <!-- Section 2: 手動補登紀錄 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">手動補登紀錄</h3>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                        <input type="text" id="manual-emp-id" placeholder="工號/卡號/密碼" class="input-magic p-2 border rounded md:col-span-1">
                        <input type="date" id="manual-date" class="input-magic p-2 border rounded">
                        <input type="time" id="manual-time" step="1" class="input-magic p-2 border rounded">
                        <select id="manual-shift-selector" class="input-magic p-2 border rounded"></select>
                        <select id="manual-status" class="input-magic p-2 border rounded"><option value="in">上班</option><option value="out">下班</option></select>
                    </div>
                    <button id="manual-punch-btn" class="btn-magic w-full mt-4 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4">執行手動補登</button>
                </div>

                <!-- Section 3: 系統特效設定 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">系統特效設定 🎨</h3>
                    <p class="text-sm text-gray-500 mb-4">增添系統氣氛與溫暖</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button id="edit-special-effects-btn" class="btn-magic bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6">節日特效 ✨</button>
                        <button id="edit-theme-schedules-btn" class="btn-magic bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6">主題特效 🎨</button>
                        <button id="edit-greetings-in-btn" class="btn-magic bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6">上班問候語 👋</button>
                        <button id="edit-greetings-out-btn" class="btn-magic bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6">下班問候語 🌙</button>
                    </div>
                </div>

                <!-- Section 4: 響鈴 -->
                <div id="bells-section" class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">作息響鈴 🔔</h3>
                        <div class="space-x-2">
                            <button id="open-bell-history-modal-btn" class="btn-magic bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 text-sm">響鈴紀錄</button>
                            <button id="open-manage-sounds-modal-btn" class="btn-magic bg-green-500 hover:bg-green-600 text-white py-2 px-4 text-sm">管理聲音</button>
                            <button id="open-add-bell-modal-btn" class="btn-magic bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 text-sm">新增響鈴</button>
                        </div>
                    </div>
                    <div id="bell-schedule-list" class="space-y-3 max-h-60 overflow-y-auto bg-gray-50 p-2 rounded-md border">
                    </div>
                </div>
             </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="password-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">管理者密碼</h2>
            <p class="text-gray-600 mb-4">請輸入管理者密碼以開啟面板。</p>
            <input type="password" id="password-input" class="input-magic w-full p-3 text-lg border border-gray-300 rounded-lg mb-6" placeholder="請輸入密碼...">
            <div class="flex justify-between items-center">
                <button id="change-admin-password-btn" class="text-sm text-blue-600 hover:underline">變更管理者密碼</button>
                <div class="space-x-4">
                    <button id="cancel-password-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                    <button id="confirm-password-btn" class="btn-magic bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6">確認</button>
                </div>
            </div>
        </div>
    </div>

    <div id="add-bell-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-lg">
            <h2 id="add-bell-modal-title" class="text-2xl font-bold text-blue-700 mb-4">新增響鈴場景</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">場景標題</label>
                    <input id="bell-title-input" type="text" placeholder="例如：午休時間到了！" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">響鈴時間</label>
                    <input id="bell-time-input" type="time" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">重複週期</label>
                    <div id="bell-weekdays-container" class="grid grid-cols-7 gap-1 mt-1"></div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">選擇音效</label>
                        <select id="bell-sound-select" class="input-magic mt-1 p-2 w-full border rounded"></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">響鈴秒數</label>
                        <input id="bell-duration-input" type="number" value="5" min="1" class="input-magic mt-1 p-2 w-full border rounded">
                    </div>
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-add-bell-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="save-bell-btn" class="btn-magic bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6">儲存</button>
            </div>
        </div>
    </div>

    <div id="manage-sounds-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-lg">
            <h2 class="text-2xl font-bold text-green-700 mb-4">聲音庫管理</h2>
            <div class="p-4 border rounded bg-gray-50 mb-4">
                <label class="block text-sm font-medium text-gray-700">新增聲音檔 (MP3, WAV)</label>
                <button id="import-sound-btn" class="btn-magic w-full mt-2 bg-teal-500 hover:bg-teal-600 text-white py-2">選擇檔案匯入</button>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">我的收藏</h3>
                <div id="custom-sound-list-modal" class="space-y-2 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="close-manage-sounds-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
            </div>
        </div>
    </div>

    <div id="bell-history-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-700">響鈴歷史</h2>
                <button id="clear-bell-history-btn" class="btn-magic bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 text-sm">清除所有紀錄</button>
            </div>
            <div id="bell-history-list-modal" class="text-sm text-gray-600 max-h-80 overflow-y-auto bg-gray-100 p-2 rounded"></div>
            <div class="flex justify-end mt-6">
                <button id="close-bell-history-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
            </div>
        </div>
    </div>

    <div id="roster-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-7xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">所有人員名冊</h2>
            <div class="max-h-[60vh] overflow-y-auto">
                <table id="roster-table" class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-4 py-3" data-sort="id">工號 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="name">姓名 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="gender">性別 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="department">部門 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="card">卡號 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3">密碼</th>
                            <th scope="col" class="px-4 py-3" data-sort="nationality">國籍 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="birth_date">出生日 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="hire_date">到職日 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="termination_date">離職日 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3" data-sort="notes">備註 <span class="sort-indicator"></span></th>
                            <th scope="col" class="px-4 py-3">操作</th>
                        </tr>
                    </thead>
                    <tbody id="roster-table-body"></tbody>
                </table>
            </div>
            <div class="flex justify-end mt-6">
                <button id="close-roster-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 id="confirm-title" class="text-2xl font-bold text-red-600 mb-4">確認操作</h2>
            <p id="confirm-message" class="text-gray-600 mb-6">您確定要執行此操作嗎？</p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-confirm-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="confirm-confirm-btn" class="btn-magic bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6">確認</button>
            </div>
        </div>
    </div>

    <div id="report-login-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 class="text-2xl font-bold text-green-700 mb-4">考勤報表登入</h2>
            <p class="text-gray-600 mb-4">請輸入您的卡號/密碼，或管理者密碼以查詢所有資料。</p>
            <input type="password" id="report-login-input" class="input-magic w-full p-3 text-lg border border-gray-300 rounded-lg mb-6" placeholder="請輸入卡號或密碼...">
            <div class="flex justify-end space-x-4">
                <button id="cancel-report-login-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="confirm-report-login-btn" class="btn-magic bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6">登入</button>
            </div>
        </div>
    </div>

    <div id="report-date-range-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 class="text-2xl font-bold text-green-700 mb-4">選擇查詢範圍</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">開始日期</label>
                    <input id="report-start-date" type="date" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">結束日期</label>
                    <input id="report-end-date" type="date" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-report-date-range-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="confirm-report-date-range-btn" class="btn-magic bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6">查詢</button>
            </div>
        </div>
    </div>

    <div id="report-view-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-7xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">考勤紀錄報表</h2>
                <div class="flex items-center space-x-4">
                    <span id="report-auto-close-timer" class="text-sm text-gray-500"></span>
                    <button id="export-report-csv-btn" class="btn-magic bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4">匯出CSV</button>
                    <button id="close-report-view-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4">關閉</button>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto">
                <table id="report-table" class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0">
                        <tr>
                            <th scope="col" class="px-4 py-3">工號</th>
                            <th scope="col" class="px-4 py-3">姓名</th>
                            <th scope="col" class="px-4 py-3">打卡日期</th>
                            <th scope="col" class="px-4 py-3">打卡時間</th>
                            <th scope="col" class="px-4 py-3">班別</th>
                            <th scope="col" class="px-4 py-3">狀態</th>
                        </tr>
                    </thead>
                    <tbody id="report-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="greetings-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-lg">
            <h2 id="greetings-title" class="text-2xl font-bold text-cyan-700 mb-4">編輯問候語</h2>
            <p class="text-gray-600 mb-4">每行一則問候語，系統會隨機選用。</p>
            <textarea id="greetings-textarea" class="w-full h-48 p-2 border rounded input-magic"></textarea>
            <div class="flex justify-end space-x-4 mt-4">
                <button id="cancel-greetings-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="save-greetings-btn" class="btn-magic bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-6">儲存</button>
            </div>
        </div>
    </div>

    <div id="special-effects-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-2xl">
            <h2 class="text-2xl font-bold text-pink-700 mb-4">節日特效排程</h2>
            <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                <h3 id="effect-form-title" class="text-lg font-semibold text-gray-800 mb-2">新增特效排程</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input id="effect-name-input" type="text" placeholder="特效名稱 (例如: 聖誕節)" class="input-magic p-2 border rounded col-span-2">
                    <input id="effect-prefix-input" type="text" placeholder="前綴符號 (例如: 🎄)" class="input-magic p-2 border rounded">
                    <input id="effect-suffix-input" type="text" placeholder="後綴符號 (例如: 🎁)" class="input-magic p-2 border rounded">
                    <div>
                        <label class="text-sm">開始日期</label>
                        <input id="effect-start-date-input" type="date" class="input-magic p-2 border rounded w-full">
                    </div>
                    <div>
                        <label class="text-sm">結束日期</label>
                        <input id="effect-end-date-input" type="date" class="input-magic p-2 border rounded w-full">
                    </div>
                </div>
                <div class="flex justify-end space-x-2 mt-4">
                    <button id="cancel-effect-edit-btn" class="btn-magic bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 hidden">取消編輯</button>
                    <button id="save-effect-btn" class="btn-magic bg-pink-600 hover:bg-pink-700 text-white py-2 px-4">儲存特效</button>
                </div>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">已設定的排程</h3>
                <div id="special-effects-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="close-effects-modal-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
            </div>
        </div>
    </div>

    <div id="theme-schedule-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-indigo-700">主題特效排程設定</h2>
                <button id="open-theme-editor-btn" class="btn-magic bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4">🎨 主題特效編輯器</button>
            </div>
            <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                <h3 id="theme-form-title" class="text-lg font-semibold text-gray-800 mb-2">新增主題排程</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input id="theme-name-input" type="text" placeholder="排程名稱 (例如: 聖誕月)" class="input-magic p-2 border rounded col-span-2">
                    <select id="theme-select-input" class="input-magic p-2 border rounded"></select>
                    <div></div>
                    <div>
                        <label class="text-sm">開始日期</label>
                        <input id="theme-start-date-input" type="date" class="input-magic p-2 border rounded w-full">
                    </div>
                    <div>
                        <label class="text-sm">結束日期</label>
                        <input id="theme-end-date-input" type="date" class="input-magic p-2 border rounded w-full">
                    </div>
                </div>
                <div class="flex justify-end space-x-2 mt-4">
                    <button id="cancel-theme-edit-btn" class="btn-magic bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 hidden">取消編輯</button>
                    <button id="save-theme-schedule-btn" class="btn-magic bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4">儲存排程</button>
                </div>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">已設定的排程</h3>
                <div id="theme-schedules-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex justify-end mt-6">
                <button id="close-theme-schedule-modal-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
            </div>
        </div>
    </div>
    
    <!-- --- 主題編輯器 --- -->
    <div id="theme-editor-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-6xl h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold text-amber-700 mb-4 flex-shrink-0">主題特效編輯器</h2>
            <div class="flex-grow grid grid-cols-3 gap-6 overflow-hidden">
                <!-- 編輯區 -->
                <div class="col-span-1 bg-gray-50 p-4 rounded-lg overflow-y-auto space-y-4">
                    <div>
                        <label class="font-bold">主題名稱</label>
                        <input id="theme-editor-name" type="text" placeholder="我的魔法主題" class="input-magic w-full p-2 mt-1 border rounded">
                    </div>
                    <!-- 色彩與字型 -->
                    <details open>
                        <summary class="font-bold cursor-pointer">🎨 色彩與字型</summary>
                        <div class="pl-4 mt-2 space-y-2">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label>背景 (漸層起始)</label>
                                    <input id="theme-editor-bg-start" type="color" value="#dfe9f3" class="w-full h-8 p-0 mt-1">
                                </div>
                                 <div>
                                    <label>背景 (漸層結束)</label>
                                    <input id="theme-editor-bg-end" type="color" value="#ffffff" class="w-full h-8 p-0 mt-1">
                                </div>
                                <div>
                                    <label>主標題文字</label>
                                    <input id="theme-editor-main-title-color" type="color" value="#1f2937" class="w-full h-8 p-0 mt-1">
                                </div>
                            </div>
                            <hr class="my-4">
                            <div class="grid grid-cols-2 gap-2">
                                <div><label>管理者按鈕背景</label><input id="theme-editor-btn-admin-bg" type="color" value="#8b5cf6" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>管理者按鈕文字</label><input id="theme-editor-btn-admin-text" type="color" value="#ffffff" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>報表按鈕背景</label><input id="theme-editor-btn-report-bg" type="color" value="#10b981" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>報表按鈕文字</label><input id="theme-editor-btn-report-text" type="color" value="#ffffff" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>AI按鈕背景</label><input id="theme-editor-btn-ai-bg" type="color" value="#3b82f6" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>AI按鈕文字</label><input id="theme-editor-btn-ai-text" type="color" value="#ffffff" class="w-full h-8 p-0 mt-1"></div>
                            </div>
                        </div>
                    </details>
                    <!-- 時鐘面板 -->
                     <details open>
                        <summary class="font-bold cursor-pointer">🕰️ 時鐘面板</summary>
                         <div class="pl-4 mt-2 space-y-2">
                            <div class="grid grid-cols-2 gap-2">
                                <div><label>背景顏色</label><input id="theme-editor-clock-bg" type="color" value="#374151" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>文字顏色</label><input id="theme-editor-clock-text" type="color" value="#ffffff" class="w-full h-8 p-0 mt-1"></div>
                                <div><label>風格設計 (左)</label><input id="theme-editor-clock-deco-left" type="text" placeholder="e.g. 🧨" class="input-magic w-full p-2 mt-1 border rounded"></div>
                                <div><label>風格設計 (右)</label><input id="theme-editor-clock-deco-right" type="text" placeholder="e.g. 🧨" class="input-magic w-full p-2 mt-1 border rounded"></div>
                                <div><label>內部裝飾 (左)</label><input id="theme-editor-clock-symbols-left" type="text" placeholder="e.g. 🎄" class="input-magic w-full p-2 mt-1 border rounded"></div>
                                <div><label>內部裝飾 (右)</label><input id="theme-editor-clock-symbols-right" type="text" placeholder="e.g. 🎁" class="input-magic w-full p-2 mt-1 border rounded"></div>
                            </div>
                         </div>
                    </details>
                    <!-- 動畫與特效 -->
                    <details>
                        <summary class="font-bold cursor-pointer">✨ 動畫與特效</summary>
                        <div class="pl-4 mt-2 space-y-2">
                            <div>
                                <label class="flex items-center"><input type="checkbox" id="theme-editor-blink-enabled" class="mr-2"> 主時鐘閃爍邊框</label>
                                <input id="theme-editor-blink-color" type="color" value="#fbc02d" class="w-full h-8 p-0 mt-1">
                            </div>
                            <hr>
                            <div>
                                <label>打卡背景特效</label>
                                <select id="theme-editor-punch-effect" class="input-magic w-full p-2 mt-1 border rounded">
                                    <option value="none">無</option>
                                    <option value="emoji">Emoji 灑落</option>
                                </select>
                                <input id="theme-editor-punch-emojis" type="text" placeholder="灑落的 Emoji (e.g. ✨,🎉,💖)" class="input-magic w-full p-2 mt-1 border rounded">
                            </div>
                        </div>
                    </details>
                </div>
                <!-- 預覽區 -->
                <div class="col-span-2 bg-gray-200 p-4 rounded-lg overflow-hidden flex items-center justify-center">
                    <div id="theme-editor-preview" class="w-full max-w-lg scale-90 origin-center">
                        <!-- 預覽內容會動態生成 -->
                    </div>
                </div>
            </div>
            <div class="flex-shrink-0 flex justify-between items-center mt-6">
                 <div>
                    <label>讀取/編輯現有主題</label>
                    <select id="theme-editor-load-select" class="input-magic p-2 border rounded"></select>
                 </div>
                 <div class="space-x-4">
                    <button id="close-theme-editor-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">關閉</button>
                    <button id="delete-custom-theme-btn" class="btn-magic bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6">刪除此主題</button>
                    <button id="save-custom-theme-btn" class="btn-magic bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-6">儲存主題</button>
                 </div>
            </div>
        </div>
    </div>


    <div id="ai-password-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">AI 系統控制</h2>
            <p class="text-gray-600 mb-4">請輸入系統密碼以繼續。</p>
            <input type="password" id="ai-password-input" class="input-magic w-full p-3 text-lg border border-gray-300 rounded-lg mb-6" placeholder="請輸入系統密碼...">
            <div class="flex justify-between items-center">
                <button id="change-system-password-btn" class="text-sm text-blue-600 hover:underline">變更系統密碼</button>
                <div class="space-x-4">
                    <button id="cancel-ai-password-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                    <button id="confirm-ai-password-btn" class="btn-magic bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6">確認</button>
                </div>
            </div>
        </div>
    </div>

    <div id="change-password-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-md">
            <h2 id="change-password-title" class="text-2xl font-bold text-gray-800 mb-4">變更密碼</h2>
            <div class="space-y-4">
                <div>
                    <label id="current-password-label" class="block text-sm font-medium text-gray-700">目前的密碼</label>
                    <input id="current-password-input" type="password" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">新的密碼</label>
                    <input id="new-password-input" type="password" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">確認新的密碼</label>
                    <input id="confirm-password-input" type="password" class="input-magic mt-1 p-2 w-full border rounded">
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-change-password-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6">取消</button>
                <button id="confirm-change-password-btn" class="btn-magic bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6">確認變更</button>
            </div>
        </div>
    </div>

    <div id="automation-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-4xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-blue-800">AI 系統控制 - 自動化排程</h2>
                <button id="close-automation-modal-btn" class="btn-magic bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4">關閉</button>
            </div>
            
            <div class="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-y-auto p-1">
                <div class="flex flex-col gap-8">
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">自動任務設定區</h3>
                        <div id="automation-tasks-list" class="space-y-2"></div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">新增自動任務</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm">週期</label>
                                <select id="auto-task-frequency" class="input-magic p-2 border rounded w-full mt-1">
                                    <option value="immediate">立即</option>
                                    <option value="daily">每日</option>
                                    <option value="weekly">每週</option>
                                    <option value="monthly">每月</option>
                                </select>
                            </div>
                             <div id="auto-task-day-weekly-container" class="hidden">
                                <label class="text-sm">日期</label>
                                <select id="auto-task-day-weekly" class="input-magic p-2 border rounded w-full mt-1">
                                    <option value="1">週一</option>
                                    <option value="2">週二</option>
                                    <option value="3">週三</option>
                                    <option value="4">週四</option>
                                    <option value="5">週五</option>
                                    <option value="6">週六</option>
                                    <option value="0">週日</option>
                                </select>
                            </div>
                            <div id="auto-task-day-monthly-container" class="hidden">
                                <label class="text-sm">日期 (1-31)</label>
                                <input id="auto-task-day-monthly" type="number" min="1" max="31" value="1" class="input-magic p-2 border rounded w-full mt-1">
                            </div>
                            <div id="auto-task-time-container" class="sm:col-span-2">
                                <label class="text-sm">時間</label>
                                <input id="auto-task-time" type="time" class="input-magic p-2 border rounded w-full mt-1">
                            </div>
                            <div>
                                <label class="text-sm">任務</label>
                                <select id="auto-task-type" class="input-magic p-2 border rounded w-full mt-1">
                                    <option value="export">匯出</option>
                                    <option value="delete">刪除</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm">目標</label>
                                <select id="auto-task-target" class="input-magic p-2 border rounded w-full mt-1">
                                    <option value="last_week_records">上週打卡紀錄</option>
                                    <option value="last_month_records">上月打卡紀錄</option>
                                    <option value="manual_records">手動補登紀錄</option>
                                    <option value="all_records">全部打卡紀錄</option>
                                    <option value="all_employees">所有人員資料</option>
                                    <option value="log">系統任務日誌</option>
                                </select>
                            </div>
                        </div>
                        <button id="save-automation-task-btn" class="btn-magic w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4">新增任務</button>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-lg border flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">系統任務日誌</h3>
                        <button id="clear-automation-log-btn" class="btn-magic bg-red-500 hover:bg-red-600 text-white py-1 px-3 text-sm">清除日誌</button>
                    </div>
                    <div id="automation-log-list" class="flex-grow space-y-2 overflow-y-auto text-sm pr-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Player -->
    <audio id="bell-audio-player"></audio>
    
    <div id="toast-container"></div>

    <!-- ✨ 魔法改造：引入總圖書館長 ✨ -->
    <script type="module" src="./renderer-scripts/main.js"></script>

</body>
</html>
